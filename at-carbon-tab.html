<link rel="import" href="../tangere/tangere.html">
<link rel="import" href="../at-carbon-icon/at-carbon-icon.html">
<link rel="import" href="../at-carbon-badge/at-carbon-badge.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">

<dom-module id="at-carbon-tab">
  <template>
    <style>
       :host {
        display: inline-block;
        padding: 0 12px;
        cursor: default;

        --tab-background-color: #EFF6FF;
        --tab-icon-color: #0050FF;
        --tab-text-color: #4A90E2;
      }

      :host * {
        box-sizing: border-box;
      }

      :host(.scrollable) {
        height: 100%;
      }

      :host([link]) {
        padding: 0;
      }

      :host([disabled]) {
        @apply --at-form-disabled;
      }

      .tab-content {
        height: 100%;
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
        transition: opacity 0.1s cubic-bezier(0.4, 0.0, 1, 1);
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
      }

       :host(:not(.iron-selected)) > .tab-content {
        opacity: 0.6;
      }

      .tab-content > ::slotted > a {
        height: 100%;
        @apply --layout-flex;
      }

      .tab-content > ::slotted {
        cursor: pointer;
      }

      .tab-content> ::slotted(a) {
        height: 100%;
        @apply --layout-flex;
      }

      .tab-content ::slotted(*) {
        cursor: pointer;
      }

      .cursor-pointer {
        cursor: pointer;
      }

      :host([tab-style="default"]) > #container {
        padding: 0 12px;
        padding-bottom: 12px;
      }

      :host([tab-style="default"].iron-selected) > #container {
        border-bottom: 2px solid var(--primary-color);
      }

      /*
        STYLES for the tab-style tab
      */
      :host([tab-style="tab"]) {
        padding: 0;
        margin-left: 1px;
      }

      :host([tab-style="tab"]) > #container {
        height: 100%;
        padding: 0 12px;

        position: relative;
        margin: 0 auto;

        border-bottom: 1px solid lightgray;
      }

      :host([tab-style="tab"].iron-selected) > #container {
        border-bottom: 2px solid var(--primary-color);
        color: var(--tab-text-color) !important;

        background-image: linear-gradient(transparent 10%, var(--tab-background-color));
      }

      :host([tab-style="tab"]) > #container:before, 
      :host([tab-style="tab"]) > #container:after {
        content: "";
        position: absolute;

        top: -1px;
        bottom: -1px;

        width: 1px;
        background-image: linear-gradient(transparent 30%, lightgray 100%);
      }

      :host([tab-style="tab"]) > #container:before {
        left: -1px;
      }

      :host([tab-style="tab"]) > #container:after {
        right: -1px;
      }

      /*
        COMPACT TAB styles
      */
      :host([tab-style="tab"][size="compact"]) > #container at-carbon-icon {
        display: none !important;
      }

      :host([tab-style="tab"][size="compact"]:hover) > #container label {
        cursor: pointer;
        color: var(--tab-text-color);
      }

      :host([tab-style="tab"][size="compact"]:focus) {
        outline: none;
      }

      :host([tab-style="tab"][size="compact"]:focus) > #container {
        background-image: linear-gradient(transparent 10%, var(--tab-background-color));
      }

      :host([tab-style="tab"][size="compact"]:focus) > #container label {
        color: var(--tab-text-color);
      }

      /*
        LARGE TAB styles
      */

      :host([tab-style="tab"][size="large"]) > #container at-carbon-icon {
        display: block !important;
        margin: 0 auto;
      }

      :host([tab-style="tab"][size="large"]) > #container label {
        display: block !important;
      }

      :host([tab-style="tab"][size="large"].iron-selected) {
        color: var(--tab-text-color);
      }

      :host([tab-style="tab"][size="large"]:hover) > #container at-carbon-icon {
        color: var(--tab-text-color);
      }

      :host([tab-style="tab"][size="large"]:hover) > #container label {
        color: var(--tab-text-color);
      }

      :host([tab-style="tab"][size="large"]:focus) {
        outline: none;
      }
      
      :host([tab-style="tab"][size="large"]:focus) > #container { 
        background-image: linear-gradient(transparent 10%, var(--tab-background-color));
      }

      :host([tab-style="tab"][size="large"]:focus) > #container at-carbon-icon {
        color: var(--tab-text-color);
      }

      :host([tab-style="tab"][size="large"]:focus) > #container label {
        color: var(--tab-text-color);
      }

      /*
        STYLES for the tab-style pill
      */

      :host([tab-style="pill"]) {
        position: relative;
      
        border: 1px solid lightgray;
      }

      :host([tab-style="pill"].iron-selected) {
        color: var(--tab-text-color) !important;
        background-color: var(--tab-background-color) !important;
      }

      /*
        PILL COMPACT styles
      */
      
      :host([tab-style="pill"][size="compact"].iron-selected) > #container label {
        color: var(--tab-text-color) !important;
      }

      :host([tab-style="pill"][size="compact"]) > #container at-carbon-icon {
        display: none !important;
      }

      :host([tab-style="pill"][size="compact"]:hover) {
        background-color: var(--at-light-grey);
      }

      :host([tab-style="pill"][size="compact"]:hover) > #container label {
        color: var(--at-black);
      }

      :host([tab-style="pill"][size="compact"]:focus) {
        outline: none;
        background-color: var(--at-light-grey);
      }

      :host([tab-style="pill"][size="compact"]:focus) > #container label {
        color: var(--tab-text-color);
      }
      
      /*
        PILL LARGE styles
      */

      :host([tab-style="pill"][size="large"]) > #container at-carbon-icon {
        display: block !important;
        margin: 0 auto;
      }

      :host([tab-style="pill"][size="large"]) > #container label {
        display: block !important;
      }

      :host([tab-style="pill"][size="large"].iron-selected) > #container at-carbon-icon {
        color: var(--tab-icon-color) !important;
      }

      :host([tab-style="pill"][size="large"].iron-selected) > #container label {
        color: var(--tab-text-color) !important;
      }

      :host([tab-style="pill"][size="large"]:hover) {
        background-color: var(--at-light-grey);
      }

      :host([tab-style="pill"][size="large"]:hover) > #container at-carbon-icon {
        color: var(--at-black);
      }

      :host([tab-style="pill"][size="large"] :hover) > #container label {
        color: var(--at-black);
      }

      :host([tab-style="pill"][size="large"]:focus) {
        outline: none;
        background-color: var(--at-light-grey);
      }

      :host([tab-style="pill"][size="large"]:focus) > #container at-carbon-icon {
        color: var(--tab-icon-color);
      }

      :host([tab-style="pill"][size="large"]:focus) > #container label {
        color: var(--tab-text-color);
      }

    </style>

    <div id="container" class$="tab-content [[_computeAdditionalClasses(label)]]">
      <div id="inner">
        <div hidden$="[[_computeLabelHidden(label, icon)]]">
          <at-carbon-icon icon="[[icon]]"></at-carbon-icon>
          <label>[[label]]</label>
        </div> 
        <div hidden$="[[_computeInnerHTMLHidden(label, icon)]]">
          <slot></slot>
        </div>
      </div>
      <at-carbon-badge id="badge" for="inner" label="[[badgeLabel]]" color="[[badgeColor]]" x-offset="6"></at-carbon-badge>
    </div>

  </template>

</dom-module>

<script>
  Polymer({

    is: 'at-carbon-tab',

    properties: {
      label: {
        type: String,
        value: ''
      },
      icon: {
        type: String,
        value: ''
      },
      badgeLabel: {
        type: String,
        value: ''
      },
      badgeColor: {
        type: String,
        value: ''
      },

      tabStyle: {
        type: String,
        value: "default",
        observer: "_tabStyleChanged",
        xvaluelist: [
          { title: "Default", value: "default" },
          { title: "Tab", value: "tab" },
          { title: "Pill", value: "pill" }
        ],
        xtype: "enum"
      },

      size: {
        type: String,
        value: "compact",
        observer: "_sizeChanged",
        xvaluelist: [
          { title: "Compact", value: "compact" },
          { title: "Large", value: "large" }
        ],
        xtype: "enum"
      }
    },

    _computeLabelHidden: function (label, icon) {
      this.async(function () {
        this.$.badge.updatePosition();
      }, 10);
      var result = !label && !icon;
      return result;
    },

    _computeInnerHTMLHidden: function(label, icon) {
      var result = !!label && !!icon;
      return result;
    },

    _computeAdditionalClasses: function(label) {
      if (label.length > 0) return "cursor-pointer";
      return "";
    },

    _tabStyleChanged: function(newValue, oldValue) {
      var fnRef = this._tabStyleChanged;
      this._tabStyleChanged = function() {};

      Polymer.dom(this).removeAttribute('tab-style');
      Polymer.dom(this).setAttribute('tab-style', newValue);

      this._tabStyleChanged = fnRef;
    },

    _sizeChanged: function(newValue, oldValue) {
      var fnRef = this._sizeChanged;
      this._sizeChanged = function() {};

      Polymer.dom(this).removeAttribute('size');
      Polymer.dom(this).setAttribute('size',  newValue);

      this._sizeChanged = fnRef;
    },
  });
</script>
